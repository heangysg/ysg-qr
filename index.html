<!DOCTYPE html>
 <html lang="en">
 <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR Code Generator | YSG</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  crossorigin="anonymous" />
  <link rel="stylesheet" href="style.css" />
 </head>
 <body>
  <header>
  <div class="logo">
  <img src="img/Y S G_ (2).png" alt="YSG Logo" />
  </div>
  <nav>
  <div class="hamburger" onclick="toggleMenu()">
  <div class="bar"></div>
  <div class="bar"></div>
  <div class="bar"></div>
  </div>
  <ul id="nav-links">
  <li><a href="index.html">Generate QR</a></li>
  <li><a href="contact.html">Contact</a></li>
  </ul>
  </nav>
  </header>
 

  <body>
 

   <div class="container">
     <h2>Generate Receipt QR Code</h2>
     <div class="receipt-input-group">
     <label for="customer-id">ID អតិថិជន:</label>
     <input type="text" id="customer-id" placeholder="Enter Customer ID" />
     </div>
     <div class="receipt-input-group">
     <label for="customer-name">ឈ្មោះអតិថិជន:</label>
     <input type="text" id="customer-name" placeholder="Enter Customer Name" />
     </div>
     <div class="receipt-input-group">
     <label for="phone-number">លេខទូរស័ព្ទ:</label>
     <input type="text" id="phone-number" placeholder="Enter Phone Number" />
     </div>
     <div class="receipt-input-group">
     <label for="machine-name">ឈ្មោះម៉ាស៊ីន:</label>
     <input type="text" id="machine-name" placeholder="Enter Machine Name" />
     </div>
     <div class="receipt-input-group">
     <label for="purchase-date">កាលបរិច្ឆេទទិញ:</label>
     <input type="date" id="purchase-date" />
     </div>
     <button id="generate-btn">បង្កើត QR Code</button>
     <div id="qrcode"></div>
     <br />
     <a id="receipt-link" href="#" style="display: none" target="_blank">មើលទិន្នន័យ QRCode</a>
    
   
     <div class="search-id-container">
     <h3>ស្វែងរកបង្កាន់ដៃដោយIDអតិថិជន</h3>
     <input type="text" id="search-customer-id" placeholder="Enter Customer ID to Search" />
     <button id="search-id-button">Search</button>
     </div>
     </div>
    
     <script>
        document.addEventListener("DOMContentLoaded", function () {
          const generateBtn = document.getElementById("generate-btn");
          const receiptLink = document.getElementById("receipt-link");
          const hamburger = document.querySelector(".hamburger");
          const navLinks = document.getElementById("nav-links");
      
          const searchButton = document.getElementById("search-id-button");
          const searchInput = document.getElementById("search-customer-id");
      
          // Handle QR generation & data saving
          generateBtn.addEventListener("click", function () {
            const customerId = document.getElementById("customer-id").value.trim();
            const customerName = document.getElementById("customer-name").value.trim();
            const phoneNumber = document.getElementById("phone-number").value.trim();
            const machineName = document.getElementById("machine-name").value.trim();
            const purchaseDate = document.getElementById("purchase-date").value;
      
            if (!customerId || !customerName || !phoneNumber || !machineName || !purchaseDate) {
              alert("Please enter all information.");
              return;
            }
      
            const receiptData = { customerId, customerName, phoneNumber, machineName, purchaseDate };
      
            // Send data to server
                            fetch('https://ysg-qr-scanner-production.up.railway.app/api/receipts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(receiptData),
                })
                .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                    throw new Error(`HTTP error! ${err.message}`);
                    });
                }
                return response.json();
                })
                .then(data => {
                alert('Receipt data saved!');
                clearForm();
                })
                .catch(error => {
                console.error('Error saving receipt:', error);
                alert(error.message || 'Error saving receipt data.');
                });

      
            // Generate QR Code
            const url = `product.html?customerId=${encodeURIComponent(customerId)}`;
            document.getElementById("qrcode").innerHTML = "";
            new QRCode(document.getElementById("qrcode"), {
              text: url,
              width: 150,
              height: 150,
            });
      
            // Set link to receipt
            receiptLink.href = url;
            receiptLink.style.display = "inline";
            receiptLink.innerText = "មើលទិន្នន័យ QRCode";
          });
      
          // Clear form fields
          function clearForm() {
            document.getElementById("customer-id").value = "";
            document.getElementById("customer-name").value = "";
            document.getElementById("phone-number").value = "";
            document.getElementById("machine-name").value = "";
            document.getElementById("purchase-date").value = "";
          }
      
          // Hamburger menu toggle
          if (hamburger) {
            hamburger.addEventListener("click", function () {
              navLinks.classList.toggle("active");
            });
          }
      
          // Search button
          if (searchButton && searchInput) {
            searchButton.addEventListener("click", function (event) {
              event.preventDefault();
              const customerId = searchInput.value.trim();
              if (customerId) {
                window.location.href = `product.html?customerId=${customerId}`;
              } else {
                alert("Please enter a Customer ID.");
              }
            });
          }
        });
      </script>
      
        

  </body>
  </html>